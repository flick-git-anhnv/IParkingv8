using System;
using System.Collections.Generic;
using System.Text;
using System.Windows.Forms;
using System.Net;
using System.Net.Sockets;
using System.Net.NetworkInformation;
using System.IO.Ports;
using Futech.Tools;


namespace Futech.DisplayLED
{
    internal class FAT810:IDisplayLED
    {
        private int _RowNumber = 1;

        public int RowNumber { get => _RowNumber; set => _RowNumber = value; }

        private System.IO.Ports.SerialPort port = new System.IO.Ports.SerialPort();
        Socket UdpServer;
        //UdpClient udp;
        IPEndPoint ipEpBroadcast;

        private int communicationtype = 0;
        public int CommunicationType
        {
            get { return communicationtype; }
            set { communicationtype = value; }
        }

        private int address = 0;
        public int Address
        {
            get { return address; }
            set { address = value; }
        }
        public FAT810()
        { }

        public bool Connect(string comport, int baudrate)
        {
            try
            {
                if (comport.Contains("COM") == true)
                {
                    communicationtype = 0;
                    //port.PortName = comport;
                    //port.BaudRate = baudrate;
                    //port.ReadBufferSize = 4096;
                    //port.WriteBufferSize = 4096;
                    //port.DataBits = 8;
                    //port.ReadTimeout = -1;
                    //port.WriteTimeout = -1;
                    //port.DtrEnable = true;
                    //port.RtsEnable = true;
                    //port.InitializeLifetimeService();

                    //port.Open();
                }
                else
                {
                    CommunicationType = 1;
                    UdpServer = new Socket(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);

                    ipEpBroadcast = new IPEndPoint(IPAddress.Parse(comport), baudrate);

                    UdpServer.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.Broadcast, 1);
                    return true;
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
            return false;
        }

        public void SendToLED(string dtimein, string dtimout, string plate, string money, int cardtype, string cardstate)
        {
            //create buffer
            if (CommunicationType == 0)
            {

            }
            else if (CommunicationType == 1)
            {

            }
        }

        public void Close()
        {
            try
            {
                if (communicationtype == 0)
                    port.Close();
                else
                {
                    UdpServer.Close();
                }
            }
            catch (Exception ex)
            {
                SystemUI.SaveLogFile("Close:" + ex.Message);
            }
        }
        public void SetParkingSlot(int slotNo, byte arrow, byte color)
        {

        }

    }
}
