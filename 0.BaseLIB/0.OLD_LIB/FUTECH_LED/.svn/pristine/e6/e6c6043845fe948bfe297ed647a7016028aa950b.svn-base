using Futech.Objects.KZE02NETControllerv2;
using Futech.Objects.SupremaCS40;
using System;
using System.Collections.Generic;
using System.Text;
using System.Windows.Forms;

namespace Futech.Objects
{
    public class Line
    {
        private IControllerSetupPage controllerSetupPage = null;
        private IControllerSettingPage controllerSettingPage = null;

        // New card event
        public event CardEventHandler CardEvent;
        public event InputEventHandler InputEvent;

        private int id = 0;
        private string code = "";
        private string name = "Line1";
        private string buidingcode = ""; // Ma toa nha
        private string pccode = ""; // Ma may tinh
        private int lineTypeID = 0;
        private int communicationType = 0;
        private string comPort = "COM1";
        private int baudRate = 9600;
        private int delayTime = 300;
        private int downloadTime = 300;
        private string description = "";
        private bool isInActive = false;

        // all controller in line
        private ControllerCollection controllers = new ControllerCollection();
        private TimezoneCollection timezones = new TimezoneCollection();
        private ControllerTypeCollection controllerTypes = new ControllerTypeCollection();



        // Constructor
        public Line()
        {

        }

        // ID property
        public int ID
        {
            get { return id; }
            set { id = value; }
        }

        // Code property
        public string Code
        {
            get { return code; }
            set { code = value; }
        }

        // Name property
        public string Name
        {
            get { return name; }
            set { name = value; }
        }

        // BuidingCode
        public string BuidingCode
        {
            get { return buidingcode; }
            set { buidingcode = value; }
        }

        // PCCode property
        public string PCCode
        {
            get { return pccode; }
            set { pccode = value; }
        }

        // LineTypeID
        public int LineTypeID
        {
            get { return lineTypeID; }
            set { lineTypeID = value; }
        }

        // Communication Type property.
        public int CommunicationType
        {
            get { return communicationType; }
            set { communicationType = value; }
        }

        // ComPort (or IPAddress) property
        public string ComPort
        {
            get { return comPort; }
            set { comPort = value; }
        }

        // BaudRate (or PortNumber) property
        public int BaudRate
        {
            get { return baudRate; }
            set { baudRate = value; }
        }

        public int DelayTime
        {
            get { return delayTime; }
            set { delayTime = value; }
        }

        public int DownloadTime
        {
            get { return downloadTime; }
            set { downloadTime = value; }
        }

        // Description property
        public string Description
        {
            get { return description; }
            set { description = value; }
        }

        // IsInActive
        public bool IsInActive
        {
            get { return isInActive; }
            set { isInActive = value; }
        }

        // Get Controller Setting Page
        public IControllerSettingPage GetControllerSettingPage
        {
            get { return controllerSettingPage; }
        }

        public IControllerSetupPage GetControllerSetupPage()
        {
            switch (lineTypeID)
            {
                case 0:// IDTECK
                    {
                        controllerSetupPage = new IDTECKSetupPage();
                        break;
                    }
                case 1: // HONEYWELL SY-MSA30/60
                    {
                        controllerSetupPage = new SYMSASetupPage();
                        break;
                    }
                case 2: // HONEYWELL NSTAR
                    {
                        controllerSetupPage = new NStarSetupPage();
                        break;
                    }
                case 3: // PEGASUS PP3760
                    {
                        controllerSetupPage = new PP3760SetupPage();
                        break;
                    }
                case 4: // PEGASUS (PP6750)
                    {
                        controllerSetupPage = new PP3760SetupPage();
                        break;
                    }
                case 5: // PEGASUS PFP3700
                    {
                        controllerSetupPage = new PFP3700SetupPage();
                        break;
                    }
                case 6:
                    {
                        controllerSetupPage = new FINGERTECSetupPage();
                        break;
                    }
                case 7:
                    {
                        controllerSetupPage = new DS3000SetupPage();
                        break;
                    }
                case 8:
                    {
                        controllerSetupPage = new CS2000SetupPage();
                        break;
                    }
                case 9:
                    {
                        controllerSetupPage = new RCP4000SetupPage();
                        break;
                    }
                case 10:
                    {
                        controllerSetupPage = new PEGASUSFINGERSetupPage();
                        break;
                    }
                case 11:
                    {
                        controllerSetupPage = new PEGASUSFINGERSetupPage();
                        break;
                    }
                case 16: // Promax - FAT810W Kanteen
                    {
                        controllerSetupPage = new FAT810WKanteenSetupPage();
                        break;
                    }
                case 17: // Promax - AC908
                    {
                        controllerSetupPage = new AC9xxSetupPage();
                        break;
                    }
                case 18: // HIS - Pack
                    {
                        controllerSetupPage = new PackSetupPage();
                        break;
                    }
                case 22: // Promax - FAT810W Parking (kiem soat vao ra va bai xe, chuc nang nhu AC908)
                    {
                        controllerSetupPage = new FAT810WParkingSetupPage();
                        break;
                    }
                case 23: // Promax - FAT810W Vending Machine (may ban hang tu dong)
                    {
                        controllerSetupPage = new FAT810WVendingMachineSetupPage();
                        break;
                    }
                case 24: // Pegasus - PP-110/PP-5210/PUA-310
                    {
                        controllerSetupPage = new PUA310SetupPage();
                        break;
                    }
                case 25: // Futech - SC100
                    {
                        controllerSetupPage = new SC100SetupPage();
                        break;
                    }
                case 26://HSR900
                    {
                        controllerSetupPage = new HSR900SetupPage();
                        break;
                    }
                case 27://AC9xxPCR
                    {
                        controllerSetupPage = new AC9xxPCRSetupPage();
                        break;
                    }
                case 28://TCPIP
                    {
                        controllerSetupPage = new TCPIPSetupPage();
                        break;
                    }
                case 29:
                    {
                        controllerSetupPage = new SC101SetupPage();
                        break;
                    }
                case 30:
                    {
                        controllerSetupPage = new SC100FPTSetupPage();
                        break;
                    }
                case 31:
                    {
                        controllerSetupPage = new SC100LANCASTERSetupPage();
                        break;
                    }
                case 32:
                    {
                        controllerSetupPage = new FUCM100SetupPage();
                        break;
                    }
                case 33:
                    {
                        controllerSetupPage = new IDTECKSetupPage8Number();
                        break;
                    }
                case 34:
                    {
                        controllerSetupPage = new E01SetupPage();
                        break;
                    }
                case 35:
                    {
                        controllerSetupPage = new E02CardIntSetupPage();
                        break;
                    }
                case 36:
                    {
                        controllerSetupPage = new FUPC100SetupPage();
                        break;
                    }

                case 37:
                    {
                        controllerSetupPage = new E02MifareSetupPage();
                        break;
                    }
                case 38:
                    {
                        controllerSetupPage = new SOYALSetupPage();
                        break;
                    }
            }

            return controllerSetupPage;
        }

        // Controller in Line
        public ControllerCollection Controllers
        {
            get { return controllers; }
            set { controllers = value; }
        }

        public TimezoneCollection Timezones
        {
            set { timezones = value; }
        }

        public ControllerTypeCollection ControllerTypes
        {
            get { return controllerTypes; }
            set { controllerTypes = value; }
        }

        // Pooling Start
        public bool Start()
        {
            switch (lineTypeID)
            {
                case 0:// IDTECK
                    {
                        controllerSettingPage = new IDTECKSettingPage();
                        break;
                    }
                case 1: // HONEYWELL SY-MSA30/60
                    {
                        controllerSettingPage = new SYMSASettingPage();
                        break;
                    }
                case 2: // HONEYWELL NSTAR
                    {
                        controllerSettingPage = new NStarSettingPage();
                        break;
                    }
                case 3: // PEGASUS PP3760
                    {
                        controllerSettingPage = new PP3760SettingPage();
                        break;
                    }
                case 4: // PEGASUS (PP6750)
                    {
                        controllerSettingPage = new PP3760SettingPage();
                        break;
                    }
                case 5: // PEGASUS PFP3700
                    {
                        controllerSettingPage = new PFP3700SettingPage();
                        break;
                    }
                case 6:
                    {
                        controllerSettingPage = new FINGERTECSettingPage();
                        break;
                    }
                case 7:
                    {
                        controllerSettingPage = new DS3000SettingPage();
                        break;
                    }
                case 8:
                    {
                        controllerSettingPage = new CS2000SettingPage();
                        break;
                    }
                case 9:
                    {
                        controllerSettingPage = new RCP4000SettingPage();
                        break;
                    }
                case 10:
                    {
                        //controllerSettingPage = new PEGASUSPB7SettingPage();
                        break;
                    }
                case 11:
                    {
                        //controllerSettingPage = new PEGASUSPB5SettingPage();
                        break;
                    }
                case 16: // Promax - FAT810W Kanteen
                    {
                        controllerSettingPage = new FAT810WKanteenSettingPage();
                        break;
                    }
                case 17: // Promax - AC908
                    {
                        controllerSettingPage = new AC9xxSettingPage();
                        break;
                    }
                case 18: // HIS - Pack
                    {
                        controllerSettingPage = new PackSettingPage();
                        break;
                    }
                case 22: // Promax - FAT810W Parking (kiem soat vao ra va bai xe, chuc nang nhu AC908)
                    {
                        controllerSettingPage = new FAT810WParkingSettingPage();
                        break;
                    }
                case 23: // Promax - FAT810W Vending Machine(may ban hang tu dong)
                    {
                        controllerSettingPage = new FAT810WVendingMachineSettingPage();
                        break;
                    }
                case 24: // Pegasus - PP-110/PP-5210/PUA-310
                    {
                        controllerSettingPage = new PUA310SettingPage();
                        break;
                    }
                case 25: // Futech - SC100
                    {
                        controllerSettingPage = new SC100SettingPage();
                        break;
                    }
                case 26:
                    {
                        controllerSettingPage = new HSR900SettingPage();
                        break;
                    }
                case 27:
                    {
                        controllerSettingPage = new AC9xxPCRSettingPage();
                        break;
                    }
                case 28:
                    {
                        controllerSettingPage = new TCPIPSettingPage();
                        break;
                    }
                case 29:
                    {
                        controllerSettingPage = new SC101SettingPage();
                        break;
                    }
                case 30:
                    {
                        controllerSettingPage = new SC100FPTSettingPage();
                        break;
                    }
                case 31:
                    {
                        controllerSettingPage = new SC100LANCASTERSettingPage();
                        break;
                    }
                case 32:
                    {
                        controllerSettingPage = new FUCM100SettingPage();
                        break;
                    }
                case 33:
                    {
                        controllerSettingPage = new IDTECKSettingPage8Number();
                        break;
                    }
                case 34:
                    {
                        controllerSettingPage = new E01SettingPage();
                        break;
                    }
                case 35:
                    {
                        controllerSettingPage = new E02CardIntSettingPage();
                        break;
                    }
                case 36:
                    {
                        controllerSettingPage = new FUPC100SettingPage();
                        break;
                    }

                case 37:
                    {
                        controllerSettingPage = new E02MifareSettingPage();
                        break;
                    }

                case 38:
                    {
                        controllerSettingPage = new SOYALSettingPage();
                        break;
                    }

                case 39:
                    {
                        controllerSettingPage = new E02MifareSR30SettingPage();
                        break;
                    }
                case 43:
                    {
                        controllerSettingPage = new FAT810WDispenserSettingPage();
                        break;
                    }
                case 44:
                    {
                        controllerSettingPage = new FUCMHID100SettingPage();
                        break;
                    }
                case 45:
                    {
                        controllerSettingPage = new USBMifareSettingPage();
                        break;
                    }
                case 46:
                    {
                        controllerSettingPage = new USBProximitySettingPage();
                        break;
                    }
                case 47:
                    {
                        controllerSettingPage = new IDTECKSettingPageSR30();
                        break;
                    }
                case 48:
                    {
                        controllerSettingPage = new E02QRCodeSettingPage();
                        break;
                    }
                case 49:
                    {
                        controllerSettingPage = new E04SettingPage();
                        break;
                    }
                case 50:
                    {
                        controllerSettingPage = new E04MifareSettingPage();
                        break;

                    }
                case 51:
                    {
                        break;
                    }
                case 52:
                    {
                        controllerSettingPage = new KZMFC01NETSettingPage();
                        break;
                    }
                case 53:
                    {
                        controllerSettingPage = new E02_FPTSettingPage();
                        break;
                    }
                case 54://E05.NET
                    {
                        break;
                    }
                case 55:
                    {
                        controllerSettingPage = new IDTECKSettingPageMifare();
                        break;
                    }

                case 61: // SupremaCS40
                    {
                        controllerSettingPage = new SupremaCS40SettingPage();
                        break;
                    }
                case 62: // BDK KZ-E02.NET
                    {
                        controllerSettingPage = new KZE02NETSettingPage();
                        break;
                    }
                case 63: // BDK KZ-E05.V2
                    {
                        break;
                    }
                case 64: // BDK SC200 - tich hop PC
                    {
                        controllerSettingPage = new SC200SettingPage();
                        break;
                    }
                case 65: // BDK KzE05.NET
                    {
                        controllerSettingPage = new KZE05NETSettingPage();
                        break;
                    }
                case 66: // BDK FAT810W_Proximity
                    {
                        controllerSettingPage = new FAT810W_Proximity_DispenserSettingPage();
                        break;
                    }
                case 67: // BDK KzE05.NET giao tiep bo nha the
                    {
                        controllerSettingPage = new MT166_SettingsPage();
                        break;
                    }
                case 68:
                    {
                        controllerSettingPage = new SOYAL_AR725_v2_SettingPage();
                        break;
                    }
                case 69:
                    {
                        controllerSettingPage = new C3_400SettingPage();
                        break;
                    }
                case 73: // BDK KzE05.NET giao tiep bo nha the	
                    {
                        controllerSettingPage = new KZE02NETv2SettingPage();
                        break;
                    }
            }

            // create setting page
            if (controllerSettingPage != null)
            {
                controllerSettingPage.LineID = id;
                controllerSettingPage.CommunicationType = communicationType;
                controllerSettingPage.DelayTime = delayTime;
                controllerSettingPage.DownloadTime = downloadTime;
                controllerSettingPage.ControllerTypes = controllerTypes;
                controllerSettingPage.Controllers = controllers;
                controllerSettingPage.Timezones = timezones;
                // Connect to readers
                controllerSettingPage.Connect(comPort, baudRate);
                // start download events
                controllerSettingPage.CardEvent += new CardEventHandler(new_CardEvent);
                controllerSettingPage.InputEvent += new InputEventHandler(new_InputEvent);
                controllerSettingPage.PollingStart();

                return controllerSettingPage.IsConnect;
            }
            return false;
        }

        // Su dung cho chuong trinh Client (chi ket noi den thiet bi, khong nhan du lieu)
        public bool Connect()
        {
            switch (lineTypeID)
            {
                case 0:// IDTECK
                    {
                        controllerSettingPage = new IDTECKSettingPage();
                        break;
                    }
                case 1: // HONEYWELL SY-MSA30/60
                    {
                        controllerSettingPage = new SYMSASettingPage();
                        break;
                    }
                case 2: // HONEYWELL NSTAR
                    {
                        controllerSettingPage = new NStarSettingPage();
                        break;
                    }
                case 3: // PEGASUS PP3760
                    {
                        controllerSettingPage = new PP3760SettingPage();
                        break;
                    }
                case 4: // PEGASUS (PP6750)
                    {
                        controllerSettingPage = new PP3760SettingPage();
                        break;
                    }
                case 5: // PEGASUS PFP3700
                    {
                        controllerSettingPage = new PFP3700SettingPage();
                        break;
                    }
                case 6:
                    {
                        controllerSettingPage = new FINGERTECSettingPage();
                        break;
                    }
                case 7:
                    {
                        controllerSettingPage = new DS3000SettingPage();
                        break;
                    }
                case 8:
                    {
                        controllerSettingPage = new CS2000SettingPage();
                        break;
                    }
                case 9:
                    {
                        controllerSettingPage = new RCP4000SettingPage();
                        break;
                    }
                case 10:
                    {
                        //controllerSettingPage = new PEGASUSPB7SettingPage();
                        break;
                    }
                case 11:
                    {
                        //controllerSettingPage = new PEGASUSPB5SettingPage();
                        break;
                    }
                case 16: // Promax - FAT810W Kanteen
                    {
                        controllerSettingPage = new FAT810WKanteenSettingPage();
                        break;
                    }
                case 17: // Promax - AC908
                    {
                        controllerSettingPage = new AC9xxSettingPage();
                        break;
                    }
                case 18: // HIS - Pack
                    {
                        controllerSettingPage = new PackSettingPage();
                        break;
                    }
                case 22: // Promax - FAT810W Parking (kiem soat vao ra va bai xe, chuc nang nhu AC908)
                    {
                        controllerSettingPage = new FAT810WParkingSettingPage();
                        break;
                    }
                case 23: // Promax - FAT810W Vending Machine (may ban hang tu dong)
                    {
                        controllerSettingPage = new FAT810WVendingMachineSettingPage();
                        break;
                    }
                case 24: // Pegasus - PP-110/PP-5210/PUA-310
                    {
                        controllerSettingPage = new PUA310SettingPage();
                        break;
                    }
                case 25: // Futech - SC100
                    {
                        controllerSettingPage = new SC100SettingPage();
                        break;
                    }
                case 26:
                    {
                        controllerSettingPage = new HSR900SettingPage();
                        break;
                    }
                case 27:
                    {
                        controllerSettingPage = new AC9xxPCRSettingPage();
                        break;
                    }
                case 28:
                    {
                        controllerSettingPage = new TCPIPSettingPage();
                        break;
                    }
                case 29:
                    {
                        controllerSettingPage = new SC101SettingPage();
                        break;
                    }
                case 30:
                    {
                        controllerSettingPage = new SC100FPTSettingPage();
                        break;
                    }
                case 31:
                    {
                        controllerSettingPage = new SC100LANCASTERSettingPage();
                        break;
                    }
                case 32:
                    {
                        controllerSettingPage = new FUCM100SettingPage();
                        break;
                    }
                case 33:
                    {
                        controllerSettingPage = new IDTECKSettingPage8Number();
                        break;
                    }
                case 34:
                    {
                        controllerSettingPage = new E01SettingPage();
                        break;
                    }
                case 35:
                    {
                        controllerSettingPage = new E02CardIntSettingPage();
                        break;
                    }
                case 36:
                    {
                        controllerSettingPage = new FUPC100SettingPage();
                        break;
                    }
                case 37:
                    {
                        controllerSettingPage = new E02MifareSettingPage();
                        break;
                    }

                case 38:
                    {
                        controllerSettingPage = new SOYALSettingPage();
                        break;
                    }
                case 39:
                    {
                        controllerSettingPage = new E02MifareSR30SettingPage();
                        break;
                    }
                case 43:
                    {
                        controllerSettingPage = new FAT810WDispenserSettingPage();
                        break;
                    }
                //44: FUCMHID
                case 44:
                    {
                        controllerSettingPage = new FUCMHID100SettingPage();
                        break;
                    }
                case 45:
                    {
                        controllerSettingPage = new USBMifareSettingPage();
                        break;
                    }
                case 46:
                    {
                        controllerSettingPage = new USBProximitySettingPage();
                        break;
                    }
                case 47:
                    {
                        controllerSettingPage = new IDTECKSettingPageSR30();
                        break;
                    }
                case 48:
                    {
                        controllerSettingPage = new E02QRCodeSettingPage();
                        break;
                    }
                case 49:
                    {
                        controllerSettingPage = new E04SettingPage();
                        break;
                    }
                case 50:
                    {
                        controllerSettingPage = new E04MifareSettingPage();
                        break;
                    }
                case 51:
                    {
                        break;
                    }
                case 52:
                    {
                        controllerSettingPage = new KZMFC01NETSettingPage();
                        break;
                    }
                case 53:
                    {
                        controllerSettingPage = new E02_FPTSettingPage();
                        break;
                    }
                case 54://E05.NET
                    {
                        break;
                    }
                case 55:
                    {
                        controllerSettingPage = new IDTECKSettingPageMifare();
                        break;
                    }
                case 61: // SupremaCS40
                    {
                        controllerSettingPage = new SupremaCS40SettingPage();
                        break;
                    }
                case 62: // BDK KZ-E02.NET
                    {
                        controllerSettingPage = new KZE02NETSettingPage();
                        break;
                    }
                case 63: // BDK KZ-E05.V2
                    {
                        break;
                    }
                case 64: // BDK SC200 - tich hop PC
                    {
                        controllerSettingPage = new SC200SettingPage()
                        {
                            ControllerTypeID = 64,
                        };
                        break;
                    }
                case 65: // BDK KzE05.NET
                    {
                        controllerSettingPage = new KZE05NETSettingPage();
                        break;
                    }
                case 67: // BDK MT166_CardDispenser - bo E05 ket hop may nha the
                    {
                        controllerSettingPage = new MT166_SettingsPage();
                        break;
                    }
                case 68: // BDK MT166_CardDispenser - bo E05 ket hop may nha the
                    {
                        controllerSettingPage = new SOYAL_AR725_v2_SettingPage();
                        break;
                    }
                case 69: // BDK MT166_CardDispenser - bo E05 ket hop may nha the
                    {
                        controllerSettingPage = new SC200SettingPage()
                        {
                            ControllerTypeID = 69,
                        };
                        break;
                    }
                case 73: // BDK KzE05.NET giao tiep bo nha the	
                    {
                        controllerSettingPage = new KZE02NETv2SettingPage();
                        break;
                    }
            }

            // create setting page
            if (controllerSettingPage != null)
            {
                controllerSettingPage.LineID = id;
                controllerSettingPage.CommunicationType = communicationType;
                controllerSettingPage.DelayTime = delayTime;
                controllerSettingPage.DownloadTime = downloadTime;
                controllerSettingPage.ControllerTypes = controllerTypes;
                controllerSettingPage.Controllers = controllers;
                controllerSettingPage.Timezones = timezones;

                // Connect to readers
                controllerSettingPage.Connect(comPort, baudRate);
                // start download events
                //controllerSettingPage.CardEvent += new CardEventHandler(new_CardEvent);
                //controllerSettingPage.PollingStart();

                return controllerSettingPage.IsConnect;
            }
            return false;
        }

        public bool DisConnect()
        {
            if (controllerSettingPage != null)
                return controllerSettingPage.DisConnect();
            return false;
        }

        // Signal To Stop
        public void SignalToStop()
        {
            if (controllerSettingPage != null)
                controllerSettingPage.SignalToStop();
        }

        // Stop
        public void Stop()
        {
            if (controllerSettingPage != null)
            {
                controllerSettingPage.PollingStop();
                controllerSettingPage.CardEvent -= new CardEventHandler(new_CardEvent);
                controllerSettingPage.InputEvent -= new InputEventHandler(new_InputEvent);
                controllerSettingPage.DisConnect();
                controllerSettingPage = null;
            }
        }

        // Card Event
        private void new_CardEvent(object sender, CardEventArgs e)
        {
            if (CardEvent != null)
            {
                CardEvent(this, e);
            }
        }
        //Input Event
        void new_InputEvent(object sender, InputEventArgs e)
        {
            if (InputEvent != null)
            {
                InputEvent(this, e);
            }
            //throw new Exception("The method or operation is not implemented.");
        }
        public string GetState()
        {
            //IControllerSettingPage ctr = new KZE02NETv2SettingPage();
            if (controllerSettingPage != null)
            {
                string m200 = controllerSettingPage.GetInputState();
                return m200;
            }
            else
            {
                return "";
            }
        }
    }
}
